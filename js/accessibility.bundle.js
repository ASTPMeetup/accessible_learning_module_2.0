!function(){function e(e){if(s.owner){if(s.owner!=e.parentNode)return}else s.owner=e.parentNode;e.setAttribute("aria-grabbed","true"),e.setAttribute("aria-selected","true"),s.items.push(e)}function t(e){e.setAttribute("aria-grabbed","false"),e.setAttribute("aria-selected","false");for(var t=s.items.length,r=0;t>r;r++)if(s.items[r]==e){s.items.splice(r,1);break}}function r(){if(s.items.length){s.owner=null;for(var e=s.items.length,t=0;e>t;t++)s.items[t].setAttribute("aria-grabbed","false"),s.items[t].setAttribute("aria-selected","false");s.items=[]}incrementProgress()}function a(e){return e.ctrlKey||e.metaKey||e.shiftKey}function n(){for(var e=o.length,t=0;e>t;t++)o[t]!=s.owner&&"none"==o[t].getAttribute("aria-dropeffect")&&(o[t].setAttribute("aria-dropeffect","move"),o[t].setAttribute("tabindex","0"));for(var e=l.length,t=0;e>t;t++)l[t].parentNode!=s.owner&&l[t].getAttribute("aria-grabbed")&&(l[t].removeAttribute("aria-grabbed"),l[t].removeAttribute("aria-selected"),l[t].removeAttribute("tabindex"))}function i(){if(s.items.length){for(var e=o.length,t=0;e>t;t++)"none"!=o[t].getAttribute("aria-dropeffect")&&(o[t].setAttribute("aria-dropeffect","none"),o[t].removeAttribute("tabindex"));for(var e=l.length,t=0;e>t;t++)l[t].getAttribute("aria-grabbed")?"true"==l[t].getAttribute("aria-grabbed")&&l[t].setAttribute("tabindex","0"):(l[t].setAttribute("aria-grabbed","false"),l[t].setAttribute("aria-selected","false"),l[t].setAttribute("tabindex","0"))}}function d(e){do if(1==e.nodeType&&e.getAttribute("aria-dropeffect"))return e;while(e=e.parentNode);return null}if(document.querySelectorAll&&"draggable"in document.createElement("span")&&!window.opera){for(var o=document.querySelectorAll('[data-draggable="target"]'),g=o.length,u=0;g>u;u++)o[u].setAttribute("aria-dropeffect","none");for(var l=document.querySelectorAll('[data-draggable="item"]'),g=l.length,u=0;g>u;u++)l[u].setAttribute("draggable","true"),l[u].setAttribute("aria-grabbed","false"),l[u].setAttribute("aria-selected","false"),l[u].setAttribute("tabindex","0");var s={items:[],owner:null,droptarget:null};document.addEventListener("mousedown",function(t){t.target.getAttribute("draggable")?(i(),a(t)||"false"!=t.target.getAttribute("aria-grabbed")||(r(),e(t.target))):a(t)?i():(i(),r())},!1),document.addEventListener("mouseup",function(r){r.target.getAttribute("draggable")&&a(r)&&("true"==r.target.getAttribute("aria-grabbed")?(t(r.target),s.items.length||(s.owner=null)):e(r.target))},!1),document.addEventListener("dragstart",function(t){return s.owner!=t.target.parentNode?void t.preventDefault():(a(t)&&"false"==t.target.getAttribute("aria-grabbed")&&e(t.target),t.dataTransfer.setData("text",""),void n())},!1),document.addEventListener("keydown",function(d){if(d.target.getAttribute("aria-grabbed")){if(32==d.keyCode){var g=document.querySelector("#popup");g&&g.parentNode.removeChild(g),a(d)?"true"==d.target.getAttribute("aria-grabbed")?(1==s.items.length&&i(),t(d.target),s.items.length&&n(),s.items.length||(s.owner=null)):(e(d.target),n()):"false"==d.target.getAttribute("aria-grabbed")?(i(),r(),e(d.target),n()):n(),d.preventDefault()}if(77==d.keyCode&&a(d)){if(s.items.length)if(n(),s.owner==o[o.length-1])o[0].focus();else for(var u=o.length,l=0;u>l;l++)if(s.owner==o[l]){o[l+1].focus();break}d.preventDefault()}}27==d.keyCode&&s.items.length&&(i(),s.items[s.items.length-1].focus(),r())},!1);var b=null;document.addEventListener("dragenter",function(e){b=e.target},!1),document.addEventListener("dragleave",function(e){var t=d(b);t==s.owner&&(t=null),t!=s.droptarget&&(s.droptarget&&(s.droptarget.className=s.droptarget.className.replace(/ dragover/g,"")),t&&(t.className+=" dragover"),s.droptarget=t)},!1),document.addEventListener("dragover",function(e){s.items.length&&e.preventDefault()},!1),document.addEventListener("dragend",function(e){if(s.droptarget){for(var t=s.items.length,a=0;t>a;a++)s.droptarget.appendChild(s.items[a]);e.preventDefault()}s.items.length&&(i(),s.droptarget&&(r(),s.droptarget.className=s.droptarget.className.replace(/ dragover/g,""),s.droptarget=null))},!1),document.addEventListener("keydown",function(e){if(e.target.getAttribute("aria-dropeffect")&&(13==e.keyCode||77==e.keyCode&&a(e))){for(var t=s.items.length,n=0;t>n;n++)e.target.appendChild(s.items[n]);i(),s.items[s.items.length-1].focus(),r(),e.preventDefault()}},!1)}}();
